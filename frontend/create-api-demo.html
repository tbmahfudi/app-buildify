<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create API Demo Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/duotone/style.css">
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-4">
    <div class="max-w-2xl w-full">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-blue-600 rounded-full mb-4">
                    <i class="ph-duotone ph-plugs-connected text-4xl text-white"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Create API Demo Page</h1>
                <p class="text-gray-600">Programmatically create a sample page with backend API integration</p>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6">
                <h3 class="font-semibold text-blue-900 mb-2">What will be created:</h3>
                <ul class="text-sm text-blue-800 space-y-1">
                    <li>✓ API Data Table - Live data from companies endpoint</li>
                    <li>✓ API Form - Submit new records to backend</li>
                    <li>✓ API Button - Fetch data on demand</li>
                    <li>✓ Full integration with /api/v1/data/* endpoints</li>
                </ul>
            </div>

            <div class="space-y-4 mb-6">
                <div class="bg-gray-50 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-900 mb-2">Page Details:</h4>
                    <div class="text-sm text-gray-700 space-y-1">
                        <p><strong>Name:</strong> API Integration Demo</p>
                        <p><strong>Route:</strong> /api-demo</p>
                        <p><strong>Slug:</strong> api-demo</p>
                        <p><strong>Module:</strong> core</p>
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <button
                    id="createPageBtn"
                    class="w-full px-6 py-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2 text-lg">
                    <i class="ph-duotone ph-rocket-launch"></i>
                    Create & Publish Page
                </button>

                <button
                    id="viewBuilderBtn"
                    class="w-full px-6 py-3 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition flex items-center justify-center gap-2">
                    <i class="ph-duotone ph-code-block"></i>
                    Go to UI Builder
                </button>
            </div>

            <div id="status" class="mt-6 hidden">
                <div class="p-4 rounded-lg" id="statusMessage"></div>
            </div>

            <div id="result" class="mt-6 hidden">
                <h3 class="font-semibold text-gray-900 mb-2">Created Page:</h3>
                <pre id="resultData" class="bg-gray-900 text-green-400 p-4 rounded-lg overflow-auto text-sm"></pre>
            </div>
        </div>

        <div class="mt-6 text-center text-sm text-gray-600">
            <p>Make sure you're logged in before creating the page</p>
        </div>
    </div>

    <script type="module">
        import { createSampleAPIPage } from './assets/js/create-sample-page.js';

        const createBtn = document.getElementById('createPageBtn');
        const viewBuilderBtn = document.getElementById('viewBuilderBtn');
        const statusDiv = document.getElementById('status');
        const statusMessage = document.getElementById('statusMessage');
        const resultDiv = document.getElementById('result');
        const resultData = document.getElementById('resultData');

        function showStatus(message, type = 'info') {
            statusDiv.classList.remove('hidden');
            statusMessage.className = `p-4 rounded-lg ${
                type === 'success' ? 'bg-green-50 border border-green-200 text-green-800' :
                type === 'error' ? 'bg-red-50 border border-red-200 text-red-800' :
                'bg-blue-50 border border-blue-200 text-blue-800'
            }`;
            statusMessage.textContent = message;
        }

        createBtn.addEventListener('click', async () => {
            try {
                // Check if logged in
                const token = localStorage.getItem('token');
                if (!token) {
                    showStatus('Please login first. Redirecting...', 'error');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                    return;
                }

                createBtn.disabled = true;
                createBtn.innerHTML = '<i class="ph-duotone ph-spinner animate-spin"></i> Creating...';
                showStatus('Creating page with API components...', 'info');

                const page = await createSampleAPIPage();

                showStatus('✅ Page created and published successfully!', 'success');
                resultDiv.classList.remove('hidden');
                resultData.textContent = JSON.stringify(page, null, 2);

                createBtn.innerHTML = '<i class="ph-duotone ph-check-circle"></i> Created!';
                createBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                createBtn.classList.add('bg-green-600', 'hover:bg-green-700');

            } catch (error) {
                console.error('Error:', error);
                showStatus(`❌ Error: ${error.message}`, 'error');
                createBtn.disabled = false;
                createBtn.innerHTML = '<i class="ph-duotone ph-rocket-launch"></i> Create & Publish Page';
            }
        });

        viewBuilderBtn.addEventListener('click', () => {
            window.location.href = '/#builder';
        });

        // Check login status on load
        window.addEventListener('load', () => {
            const token = localStorage.getItem('token');
            if (!token) {
                showStatus('⚠️ Warning: You need to be logged in to create pages', 'error');
            }
        });
    </script>

    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</body>
</html>
